%PEMG UT Austin 2021
%Michael Solomentsev, Alex Hanson

% 2-D Zero Ampere Turns Method
% 6 Turns in two columns; 1/2/3 are paralleled
% Figure 7(c)

syms a ax ay r l1 l2 I_p d la;
freq = .3*10^6;
calc_omega = 2*pi*freq;
calc_d = sqrt(2*1.68*10^-8/(calc_omega*1.256*10^-6)); 

A = [
    %Primary current identity
    0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;

    %Series currents
    0 0 0 -1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 -1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;

    %Ks have to sum to current in each wire
    -1 0 0 0 0 0 r r r r 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 -1 0 0 0 0 0 0 0 0 r r r r 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 -1 0 0 0 0 0 0 0 0 0 0 0 r r r r 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 -1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 r r r r 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 -1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 r r r r 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 -1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 r r r r 0 0 0 0 0 0 0;
    
    %Amperian Loops around surface current densities
    %    outer surface current densities must be zero
    %1
    0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 0 0 0 0;
    
    %2
    0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 0 0 0;
    
    %3
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0 0;
    
    %4
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -1 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    
    %5
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 1 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 -1;
    
    %6
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 1;
    
    %Gauss' Law at Flux Nodes
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -ax*la ay*l1 -ay*l2 ax*la 0 0 0;
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -ax*la ay*l1 -ay*l2 ax*la;
    
    %Faraday loop between paralleled turns
    %1R to 2L
    0 0 0 0 0 0 0 0 .5*d*d 0 -.5*d*d 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -ax*la 0 0 0 0 0 0;
    
    %2L to 3T
    0 0 0 0 0 0 0 0 0 0 .5*d*d 0 0 0 0 -.5*d*d 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -ax*la ay*l1 0 0 0 0 0;
    ];

B = [I_p; 0; 0;
    0; 0; 0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0; 0; 0;
    0; 0;
    0; 0;
    ];

X = linsolve(A,B);

X = subs(X,la,2*pi*.002375);
X = subs(X,l1,2*pi*.0016875);
X = subs(X,l2,2*pi*.0030625);
X = subs(X,I_p,1);
X = subs(X,d,calc_d);
X = subs(X,ax,.00025);
X = subs(X,ay,.00025);
X = subs(X,r,.001125);
X=double(X);

sum = X(1)+X(2)+X(3);
I1ratio = (X(1)/sum)
I2ratio = (X(2)/sum)
I3ratio = (X(3)/sum)